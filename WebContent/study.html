<html>
<head>
  <script type="text/javascript" src="http://jsbin.com/datelib/1/js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.5/dojo/dojo.xd.js"></script>
<script type="text/javascript">
/*
{
correctMultiplier : 4,
initialInterval : 2,
delimiter: "    ",
measureRealIntervals : true,
alertOnCardDue : true,
fontsize: "40px",
tripletLoad : true
}

*/

        var djConfig = {
            parseOnLoad: false,
            isDebug: false,
            locale: 'en-us',
            debugAtAllCosts: false
        };
</script>

<script type="text/javascript" src="js/Scheduler.js" ></script>

<script type="text/javascript" >
var sched = new Scheduler()
var currentCard = null
    
function onCheckboxChange(){
    if(dojo.byId('chkbox').checked){
        sched.cardIsScheduledCallback  = showNewCardButton
    }else{
        sched.cardIsScheduledCallback  = showNewCard
    }
}

function parseInputWords(){
    try{
      var input = dojo.trim(dojo.byId("input-words").value)
      if(input==""){
          return
      }
      var lines = input.split('\n')
      var front
      var back
      var parts
      console.log("lines.length: "+lines.length)
      
      if(sched.tripletLoad){
          var cards = tripletParse(lines)
          var c
          for(var i  = 0; i < cards.length ; i++){
              c = cards[i]
              sched.addWord(c.front,c.back)
          }
      }else {
          for(var i =  0 ; i < lines.length ; i++){
              parts = lines[i].split(sched.delimiter)
              front = parts[0]
              back = parts[1]
              sched.addWord(front, back)
          }
      }
      dojo.byId("input-words").value=""
      sched.nextCardOrPause()
    }catch(e){alert(e)}
}

function tripletParse(lines){
    if(lines.length % 3 != 0){
        throw new Error("Lines must be a multiple of 3 when parsing triplets.")
    }
    var cards = []
    var eng
    var pinyin
    var chars
    while(lines.length > 0){
        eng = lines.pop()
        pinyin = lines.pop()
        chars = lines.pop()
        cards.push({
            back: pinyin +" - "+eng,
            front: chars
            
        })
    }
    return cards
}

function showAnswer(){
    dojo.byId('answer-div').style.display="block"
    dojo.byId('answer-span').innerHTML=currentCard.back
}
var timeShown = null

function showNewCardButton(card){
    var b = dojo.byId('show-card-button')
    b.style.display="block"
    b.onclick = function(){showNewCard(card)}
    if(sched.alertOnCardDue){
        alert('card due')
    }
}

function showNewCard(card){
    dojo.byId('current-card').style.display="block"
    dojo.byId('current-word-front').value = card.front
    timeShown=new Date().getTime()
    currentCard = card
}

function markCardCorrect(){
    sched.rememberedCard(timeShown)
    setupForNextCard()
}


function setupForNextCard(){
    dojo.byId('show-card-button').style.display="none"
    dojo.byId('answer-div').style.display="none"
    dojo.byId('current-word-front').value = ""
    dojo.byId('current-card').style.display="none"
    dojo.byId('card-due').innerHTML = sched.nextCardDueDate.toString("h:mm:ss")
}


function markCardWrong(){
    sched.forgotCard(timeShown)
    setupForNextCard()
}

dojo.addOnLoad(function(){
	dojo.byId('current-word-front').value = ""
	dojo.byId("current-word-front").style.fontSize=sched.fontsize;
	onCheckboxChange()
})


function reloadConfig(){
    console.log('reloaded config')
    dojo.xhrGet({
        url:"config.json",
        handleAs:"json",
        load: function(data){
            for(var i in data){
               sched[i]=data[i]
            }
            dojo.byId('current-word-front').style.fontSize=sched.fontsize
        }
    });
}

reloadConfig()

  //setInterval(reloadConfig,2000)

setInterval(function(){
    dojo.byId("time-now").innerHTML=new Date().toString("h:mm:ss")
},1000)



</script>

</head>
<body><center>
Input words:<br/>
<textarea value="hi" cols=30 rows=3 id="input-words"></textarea>
<br/>
<input type="button" value="Parse" onclick="parseInputWords()"></input>
<input type="button" value="Load Config" onclick="reloadConfig()"></input>

<label for="chkbox">Uncover button</label>
<input type="checkbox" checked="yes" id="chkbox" onChange="onCheckboxChange()"></input>


<br/>
Next card due: <span id="card-due">none</span>
<br/>
Time Now:<span id="time-now"></span>
<br/>

<div id="show-card-button" style="display:none">
    <input type="button" value="Show Card" ></input>
</div>

<div id="current-card" style="display:none">
    Current card:<br/>
    <textarea cols=10 rows=2 id="current-word-front"></textarea>
    <br/>
    <input type="button" value="Show answer" onclick="showAnswer()"></input>
</div>

<div id="answer-div" style="display:none">
    <div>
    <div id="answer-span" style="border: solid black 1px;padding: 10px; margin:10px">
    The answer
    </div>
    </div>
    <div style="margin:20px 0px">
    <input type="button" value="Correct" onclick="markCardCorrect()"></input>
    <input type="button" value="Wrong" onclick="markCardWrong()"></input>
    </div>
</div>
</center>
  
</body>
</html>
